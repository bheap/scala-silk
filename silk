#!/bin/bash

cleaner () {
  sp=`ps -A | grep 'silk.jar -t preview' | grep -v grep | awk '{print $1}'`
  if [ $sp > 0 ]; then
    kill $sp
  fi
}

SK=$HOME/.silk
SKMC=$SK/config
SKSP=$SK/repositories/site-prototype
if [ "$1" == "preview-start" ]; then
  cleaner
  java -jar $HOME/bin/silk.jar -t preview-start &
elif [ "$1" == "preview-stop" ]; then
  echo "Silk preview is stopped."
  cleaner
elif [ "$1" == "sites" ]; then
  echo "Installed site-prototypes are:"
  find $SKSP -type f -name dna.xml -exec grep 'id' {} \;
elif [ "$1" == "update" ]; then
  mkdir -p $SKMC
  curl "http://www.bheap.co.uk/downloads/silk/updates/0.1.0/silk.xml" \
          > $SKMC/silk.xml
	mkdir -p $SKSP
	curl "http://www.bheap.co.uk/downloads/silk/updates/0.1.0/site-prototype.tgz" \
	        > site-prototype.tgz
	tar xf site-prototype.tgz -C $SKSP
	rm site-prototype.tgz
  echo "Silk update complete"
elif [ "$1" == "spin" ]; then
  rm -rf ${PWD}/site
  mkdir ${PWD}/site
  java -jar $HOME/bin/silk.jar -t $1 $2
else
  java -jar $HOME/bin/silk.jar -t $1 $2
fi

